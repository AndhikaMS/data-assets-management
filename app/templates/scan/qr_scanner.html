{% extends "base.html" %}

{% block title %}Scan QR Code - Asset Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/scan.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            <i class="bi bi-qr-code-scan"></i> Scan QR Code
        </h2>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Kembali
        </a>
    </div>
    
    <div class="row">
        <!-- Scanner -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div id="scanner-container">
                        <video id="video" autoplay playsinline></video>
                        <canvas id="canvas"></canvas>
                        
                        <!-- Scanner Overlay -->
                        <div class="scanner-overlay">
                            <div class="scanner-corner corner-tl"></div>
                            <div class="scanner-corner corner-tr"></div>
                            <div class="scanner-corner corner-bl"></div>
                            <div class="scanner-corner corner-br"></div>
                        </div>
                        
                        <!-- Status Indicator -->
                        <div id="status" class="status-indicator status-ready">
                            <i class="bi bi-camera-video"></i> Ready
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button id="startBtn" class="btn btn-success" disabled>
                            <i class="bi bi-play-fill"></i> Mulai Scan
                        </button>
                        <button id="stopBtn" class="btn btn-danger" style="display: none;">
                            <i class="bi bi-stop-fill"></i> Stop
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Instructions & Results -->
        <div class="col-md-4">
            <!-- Instructions -->
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle"></i> Cara Scan
                    </h5>
                </div>
                <div class="card-body">
                    <ol class="small">
                        <li>Izinkan akses kamera saat diminta</li>
                        <li>Klik "Mulai Scan"</li>
                        <li>Arahkan QR Code ke kamera</li>
                        <li>Tunggu hingga QR terdeteksi</li>
                        <li>Otomatis redirect ke detail aset</li>
                    </ol>
                    
                    <div class="alert alert-info mt-3">
                        <small>
                            <i class="bi bi-lightbulb"></i>
                            <strong>Tips:</strong> Pastikan QR Code dalam fokus dan pencahayaan cukup
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- Scan Results -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-list-check"></i> Hasil Scan
                    </h5>
                </div>
                <div class="card-body">
                    <div id="result-area">
                        <p class="text-muted text-center">
                            <i class="bi bi-qr-code" style="font-size: 3rem;"></i><br>
                            Belum ada QR yang terdeteksi
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script src="{{ url_for('static', filename='js/qr_scanner.js') }}"></script>
{% endblock %}